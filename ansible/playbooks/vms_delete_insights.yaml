---
- name: Delete system from Insights 
  hosts: all
  gather_facts: false
  collections:
    - redhat.satellite

  tasks:

    - name: Unregister the insights client
      ansible.builtin.command: insights-client --unregister
      when: 
        - env_delete == "dev"
        - inventory_hostname in groups['foreman_demo_dev']  

    - name: Unregister the insights client
      ansible.builtin.command: insights-client --unregister
      when: 
        - env_delete == "qualif"
        - inventory_hostname in groups['foreman_demo_qualif']

    - name: Unregister the insights client
      ansible.builtin.command: insights-client --unregister
      when: 
        - env_delete == "prod"
        - inventory_hostname in groups['foreman_demo_prod']

    - name: Unregister the insights client
      ansible.builtin.command: insights-client --unregister
      when: 
        - env_delete == "all"
        - inventory_hostname in groups['foreman_demo_dev']
    
    - name: Unregister the insights client
      ansible.builtin.command: insights-client --unregister
      when: 
        - env_delete == "all"
        - inventory_hostname in groups['foreman_demo_qualif']

    - name: Unregister the insights client
      ansible.builtin.command: insights-client --unregister
      when: 
        - env_delete == "all"
        - inventory_hostname in groups['foreman_demo_prod']